# -*- coding: utf-8 -*-
"""
AIコード.py の input_text と input_request の違い整理

## 📋 処理フロー比較表

| 処理ステップ | input_text | input_request | 備考 |
|--------------|------------|---------------|------|
| **1. 添付ファイル追記** | ✅ あり (176-186行) | ✅ あり (241-251行) | 完全に同じロジック |
| **2. 処理要求ログ** | ✅ あり (190-192行) | ✅ あり (256-258行) | メッセージが若干異なる |
| **3. 【前処理】チャンネル-1へ開始通知** | ❌ なし | ✅ あり (260-285行) | LiveAI音声通知付き |
| **4. AI実行** | ✅ あり (196-206行) | ✅ あり (290-300行) | 完全に同じロジック |
| **5. 処理応答ログ** | ✅ あり (209-211行) | ✅ あり (303-305行) | メッセージが若干異なる |
| **6. output_text送信（自チャンネル）** | ✅ あり (214-220行) | ✅ あり (308-314行) | 完全に同じ |
| **7. 会話履歴保存（自チャンネル）** | ✅ あり (223-231行) | ✅ あり (317-325行) | 完全に同じ |
| **8. 【追加処理】バックアップ検証ループ** | ❌ なし | ✅ あり (328-335行) | 最大6回の自己検証 |
| **9. 【追加処理】生成ファイル通知** | ❌ なし | ✅ あり (337-341行) | チャンネル-1へ画像等通知 |
| **10. output_request送信（チャンネル0）** | ❌ なし | ✅ あり (344-350行) | マスター通知 |
| **11. 会話履歴保存（チャンネル0）** | ❌ なし | ✅ あり (353-361行) | マスター履歴 |
| **12. 【後処理】チャンネル-1へ完了通知** | ❌ なし | ✅ あり (363-391行) | LiveAI音声通知付き |
| **13. update_info送信** | ❌ なし | ✅ あり (393-398行) | 更新ファイル一覧通知 |

## 🎯 主な違い

### 1️⃣ input_text（シンプル処理）
- **用途**: 通常のテキスト対話
- **処理**: AI実行 → 結果を自チャンネルに送信 → 終了
- **通知先**: 自チャンネルのみ
- **特徴**: シンプル、高速

### 2️⃣ input_request（フル機能処理）
- **用途**: コード生成・検証が必要な重要タスク
- **処理**: 
  1. チャンネル-1に開始通知（音声）
  2. AI実行
  3. 結果を自チャンネルに送信
  4. **バックアップ＋自己検証ループ（最大6回）**
  5. 生成ファイル通知
  6. チャンネル0にoutput_request送信
  7. チャンネル-1に完了通知（音声）
  8. update_info送信（更新ファイル一覧）
- **通知先**: 自チャンネル + チャンネル0 + チャンネル-1
- **特徴**: 自己検証、マルチ通知、音声フィードバック

## 📊 コード行数比較

| 項目 | input_text | input_request |
|------|------------|---------------|
| 総行数 | 64行 (170-233行) | 167行 (235-401行) |
| 共通処理 | 約50行 | 約50行 |
| 追加処理 | 0行 | 約117行 |

## 🔍 通知チャンネル整理

### チャンネル構造
- **チャンネル0**: マスター（全体管理）
- **チャンネル1-4**: コードエージェント（実作業）
- **チャンネル-1**: LiveAI（音声フィードバック）

### input_text の通知
```
自チャンネル(1-4) ← output_text
```

### input_request の通知
```
【開始時】
チャンネル-1 ← input_text（開始通知） + LiveAI音声

【AI実行後】
自チャンネル(1-4) ← output_text
チャンネル-1 ← output_file（生成画像等）
チャンネル0 ← output_request

【完了時】
チャンネル-1 ← input_text（完了通知） + LiveAI音声
自チャンネル(1-4) ← update_info（更新ファイル一覧）
```

## 💡 使い分けの指針

| 用途 | 推奨 |
|------|------|
| 簡単な質問・相談 | input_text |
| コード生成・修正 | input_request |
| ファイル編集要求 | input_request |
| デバッグ・検証が必要 | input_request |
| 音声フィードバックが必要 | input_request |

## 🚀 処理フロー図

### input_text（シンプル）
```
input_text受信
    ↓
添付ファイル追記
    ↓
AI実行
    ↓
output_text送信（自チャンネル）
    ↓
会話履歴保存
    ↓
完了
```

### input_request（フル機能）
```
input_request受信
    ↓
添付ファイル追記
    ↓
チャンネル-1へ開始通知 + LiveAI音声 ★
    ↓
AI実行
    ↓
output_text送信（自チャンネル）
    ↓
会話履歴保存
    ↓
【重要】バックアップ検証ループ（最大6回） ★
    ├─ バックアップ実行
    ├─ 差分ファイル検出
    ├─ AI検証実行
    └─ 修正 → 再バックアップ → ...
    ↓
生成ファイル通知（チャンネル-1） ★
    ↓
output_request送信（チャンネル0） ★
    ↓
会話履歴保存（チャンネル0）
    ↓
チャンネル-1へ完了通知 + LiveAI音声 ★
    ↓
update_info送信（更新ファイル一覧） ★
    ↓
完了
```

★マーク = input_request専用の処理

## 📝 重要な気づき

**あなたの指摘の通り、基本的なAI実行部分は完全に同じです！**

- 添付ファイル処理: 完全一致
- AI実行ロジック: 完全一致
- output_text送信: 完全一致
- 会話履歴保存: 完全一致

**違うのは「前処理」と「後処理」だけ：**
- input_text: 前後処理なし（純粋なAI対話）
- input_request: 前後処理フル装備（コード生成ワークフロー）

## 🎯 結論

**input_request = input_text + コード生成ワークフロー**

- バックアップ＋検証ループ（最大6回）← これが一番重要
- マルチチャンネル通知
- 音声フィードバック
- 更新ファイル管理
"""
