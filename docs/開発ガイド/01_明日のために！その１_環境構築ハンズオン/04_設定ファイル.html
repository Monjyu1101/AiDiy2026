<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>04 設定ファイル</title>
  <link rel="stylesheet" href="../_shared/doc.css">
  <script src="../_shared/doc.js" defer></script>
</head>
<body>
  <nav>
    <a href="03_start.py解説.html">前へ: 03_start.py解説</a>
    <a href="_index.html">目次へ戻る</a>
    <a href="99_まとめ.html">次へ: 99_まとめ</a>
  </nav>

  <h1>04_設定ファイル</h1>
  <p>このページでは、環境構築時に最初に確認すべき設定ファイルを整理します。</p>

  <h2>確認対象</h2>
  <table>
    <tr><th>パス</th><th>役割</th></tr>
    <tr><td><code>workspace/AiDiy2026/backend_server/conf/</code></td><td>バックエンド設定（認証や動作設定）</td></tr>
    <tr><td><code>workspace/AiDiy2026/frontend_server/vite.config.ts</code></td><td>フロントエンド開発サーバー設定と Proxy</td></tr>
  </table>

  <h2>backend_server/conf の要点</h2>
  <ul>
    <li>実行環境で使う設定値を集中管理する</li>
    <li>認証関連（例: <code>SECRET_KEY</code>, <code>ALGORITHM</code>）を含む</li>
    <li>値の変更時は影響範囲（JWT再発行など）を意識する</li>
  </ul>

  <h3>注意点</h3>
  <table>
    <tr><th>項目</th><th>注意</th></tr>
    <tr><td><code>SECRET_KEY</code></td><td>漏洩禁止。変更時は既存トークン無効化の影響が出る</td></tr>
    <tr><td>DB設定</td><td>SQLite 運用では DB ファイルの場所確認が重要</td></tr>
    <tr><td>ポート設定</td><td><code>_start.py</code> と矛盾しないようにする</td></tr>
  </table>

  <h2>vite.config.ts の要点</h2>
  <p>フロントエンドの開発体験と API 接続動作を決めるファイルです。</p>
  <pre><code>server: {
  port: 8090,
  host: '0.0.0.0',
  proxy: {
    '/core': { target: 'http://localhost:8091', changeOrigin: true },
    '/apps': { target: 'http://localhost:8092', changeOrigin: true }
  }
}</code></pre>

  <h3>Proxy を使う理由</h3>
  <ul>
    <li>フロントエンドは同一オリジン（8090）として API を呼べる</li>
    <li>バックエンドの実ポート（8091/8092）を画面側から意識しなくてよい</li>
    <li>CORS 周りのトラブルを減らせる</li>
  </ul>

  <h2>変更時の連動チェック</h2>
  <ol>
    <li><code>vite.config.ts</code> のポートを変えたら <code>_start.py</code> も確認する</li>
    <li>API 側 CORS 許可オリジンを更新する</li>
    <li>ブラウザアクセスURLの案内文書も更新する</li>
  </ol>

  <h2>よくある不具合と確認箇所</h2>
  <table>
    <tr><th>症状</th><th>確認箇所</th><th>対処</th></tr>
    <tr><td>API が 404</td><td><code>vite.config.ts</code> の proxy</td><td><code>/core</code> / <code>/apps</code> の target を確認</td></tr>
    <tr><td>CORS エラー</td><td>バックエンドCORS設定</td><td>8090 を許可オリジンに含める</td></tr>
    <tr><td>ログイン後に 401</td><td>JWT関連設定</td><td><code>SECRET_KEY</code> 変更有無とトークン再取得を確認</td></tr>
  </table>

  <nav>
    <a href="03_start.py解説.html">前へ: 03_start.py解説</a>
    <a href="_index.html">目次へ戻る</a>
    <a href="99_まとめ.html">次へ: 99_まとめ</a>
  </nav>
</body>
</html>

