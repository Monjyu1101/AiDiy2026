-- ============================================================
-- M商品 データベース設計書
-- ============================================================
-- 作成日: 2026-02-15
-- バージョン: 1.0
-- データベース: SQLite
-- 文字コード: UTF-8
-- ============================================================

-- ------------------------------------------------------------
-- 1. テーブル概要
-- ------------------------------------------------------------
-- テーブル名: M商品
-- 物理名: M商品（日本語テーブル名）
-- 主キー: 商品ID
-- 概要: 商品マスタ情報を管理する
-- 備考: 監査フィールド8項目を含む
-- ------------------------------------------------------------

-- ------------------------------------------------------------
-- 2. テーブル定義
-- ------------------------------------------------------------
CREATE TABLE M商品 (
 -- ========================================
 -- 主キー
 -- ========================================
 商品ID TEXT PRIMARY KEY, -- 商品を一意に識別するID（手動入力）

 -- ========================================
 -- 業務フィールド
 -- ========================================
 商品名 TEXT NOT NULL, -- 商品名（最大200文字）
 単位 TEXT NOT NULL, -- 単位（個、箱、kg等）（最大50文字）
 商品備考 TEXT, -- 備考（最大500文字）

 -- ========================================
 -- 監査フィールド（登録）
 -- ========================================
 登録日時 TEXT NOT NULL, -- 登録日時（YYYY-MM-DD HH:MM:SS）
 登録利用者ID TEXT NOT NULL, -- 登録した利用者のID
 登録利用者名 TEXT, -- 登録した利用者の名前
 登録端末ID TEXT NOT NULL, -- 登録した端末のIP等

 -- ========================================
 -- 監査フィールド（更新）
 -- ========================================
 更新日時 TEXT NOT NULL, -- 最終更新日時（YYYY-MM-DD HH:MM:SS）
 更新利用者ID TEXT NOT NULL, -- 最終更新した利用者のID
 更新利用者名 TEXT, -- 最終更新した利用者の名前
 更新端末ID TEXT NOT NULL -- 最終更新した端末のIP等
);

-- ------------------------------------------------------------
-- 3. カラム定義詳細
-- ------------------------------------------------------------
-- ┌─────────────┬──────────┬──────┬─────────┬──────────────────────────────┐
-- │ カラム名 │ データ型 │ NULL │ 制約 │ 説明 │
-- ├─────────────┼──────────┼──────┼─────────┼──────────────────────────────┤
-- │ 商品ID │ TEXT │ NOT │ PK │ 商品を一意に識別するID │
-- │ 商品名 │ TEXT │ NOT │ - │ 商品名（最大200文字） │
-- │ 単位 │ TEXT │ NOT │ - │ 単位（個、箱、kg等） │
-- │ 商品備考 │ TEXT │ NULL │ - │ 備考（最大500文字） │
-- │ 登録日時 │ TEXT │ NOT │ - │ 登録日時 │
-- │ 登録利用者ID│ TEXT │ NOT │ - │ 登録した利用者のID │
-- │ 登録利用者名│ TEXT │ NULL │ - │ 登録した利用者の名前 │
-- │ 登録端末ID │ TEXT │ NOT │ - │ 登録した端末のIP等 │
-- │ 更新日時 │ TEXT │ NOT │ - │ 最終更新日時 │
-- │ 更新利用者ID│ TEXT │ NOT │ - │ 最終更新した利用者のID │
-- │ 更新利用者名│ TEXT │ NULL │ - │ 最終更新した利用者の名前 │
-- │ 更新端末ID │ TEXT │ NOT │ - │ 最終更新した端末のIP等 │
-- └─────────────┴──────────┴──────┴─────────┴──────────────────────────────┘

-- ------------------------------------------------------------
-- 4. インデックス設計
-- ------------------------------------------------------------
-- 主キーインデックス: 商品ID（自動作成）
-- 追加インデックス: 現時点では不要
--
-- ※ 将来的にデータ量が増えた場合、以下のインデックスを検討：
-- - 商品名（検索用）
-- - 更新日時（ソート用）
-- ------------------------------------------------------------

-- ------------------------------------------------------------
-- 5. サンプルデータ
-- ------------------------------------------------------------

-- サンプルデータ1
INSERT INTO M商品 (
 商品ID,
 商品名,
 単位,
 商品備考,
 登録日時,
 登録利用者ID,
 登録利用者名,
 登録端末ID,
 更新日時,
 更新利用者ID,
 更新利用者名,
 更新端末ID
) VALUES (
 'ITEM001',
 'テスト商品A',
 '個',
 'サンプルデータです',
 '2026-02-15 10:00:00',
 'admin',
 '管理者',
 '192.168.1.100',
 '2026-02-15 10:00:00',
 'admin',
 '管理者',
 '192.168.1.100'
);

-- サンプルデータ2
INSERT INTO M商品 (
 商品ID,
 商品名,
 単位,
 商品備考,
 登録日時,
 登録利用者ID,
 登録利用者名,
 登録端末ID,
 更新日時,
 更新利用者ID,
 更新利用者名,
 更新端末ID
) VALUES (
 'ITEM002',
 'テスト商品B',
 '箱',
 '10個入り',
 '2026-02-15 10:30:00',
 'admin',
 '管理者',
 '192.168.1.100',
 '2026-02-15 10:30:00',
 'admin',
 '管理者',
 '192.168.1.100'
);

-- サンプルデータ3
INSERT INTO M商品 (
 商品ID,
 商品名,
 単位,
 商品備考,
 登録日時,
 登録利用者ID,
 登録利用者名,
 登録端末ID,
 更新日時,
 更新利用者ID,
 更新利用者名,
 更新端末ID
) VALUES (
 'ITEM003',
 'テスト商品C',
 'kg',
 '重量商品',
 '2026-02-15 11:00:00',
 'admin',
 '管理者',
 '192.168.1.100',
 '2026-02-15 11:00:00',
 'admin',
 '管理者',
 '192.168.1.100'
);

-- ------------------------------------------------------------
-- 6. データ確認クエリ
-- ------------------------------------------------------------

-- 全件取得（一覧表示用）
SELECT
 商品ID,
 商品名,
 単位,
 商品備考,
 更新日時,
 更新利用者名
FROM M商品
ORDER BY 商品ID
LIMIT 10000;

-- 1件取得（詳細表示用）
SELECT
 商品ID,
 商品名,
 単位,
 商品備考,
 登録日時,
 登録利用者ID,
 登録利用者名,
 登録端末ID,
 更新日時,
 更新利用者ID,
 更新利用者名,
 更新端末ID
FROM M商品
WHERE 商品ID = 'ITEM001';

-- 件数確認
SELECT COUNT(*) AS 件数 FROM M商品;

-- ------------------------------------------------------------
-- 7. データ型について
-- ------------------------------------------------------------
-- SQLiteのデータ型仕様:
-- TEXT : 文字列データ（可変長）
-- INTEGER : 整数
-- REAL : 浮動小数点数
-- BLOB : バイナリデータ
--
-- このテーブルでは全てTEXT型を使用:
-- - 日時もTEXT型で格納（YYYY-MM-DD HH:MM:SS形式）
-- - 数値項目がないため、TEXT型で統一
-- - 日本語カラム名を使用（UTF-8エンコーディング）
-- ------------------------------------------------------------

-- ------------------------------------------------------------
-- 8. 制約について
-- ------------------------------------------------------------
-- PRIMARY KEY (主キー):
-- - 商品ID: テーブル内で一意である必要がある
-- - NULL不可
-- - 自動的にインデックスが作成される
--
-- NOT NULL制約:
-- - 必須項目に設定
-- - 商品ID、商品名、単位: 業務上必須
-- - 監査フィールド（ID、日時、端末）: システムで自動設定されるため必須
-- - 監査フィールド（名前）: 利用者名が取得できない場合を考慮してNULL許可
-- ------------------------------------------------------------

-- ------------------------------------------------------------
-- 9. バリデーションルール（アプリケーション側で実装）
-- ------------------------------------------------------------
-- 商品ID:
-- - 必須チェック
-- - 最大50文字
-- - 重複チェック（登録時）
--
-- 商品名:
-- - 必須チェック
-- - 最大200文字
--
-- 単位:
-- - 必須チェック
-- - 最大50文字
--
-- 商品備考:
-- - 最大500文字
-- ------------------------------------------------------------

-- ------------------------------------------------------------
-- 10. 監査フィールドの設定タイミング
-- ------------------------------------------------------------
-- 登録時:
-- - 登録日時 = 現在日時
-- - 登録利用者ID = JWT認証から取得
-- - 登録利用者名 = JWT認証から取得
-- - 登録端末ID = リクエスト元IP
-- - 更新日時 = 現在日時
-- - 更新利用者ID = JWT認証から取得
-- - 更新利用者名 = JWT認証から取得
-- - 更新端末ID = リクエスト元IP
--
-- 更新時:
-- - 登録系フィールド = 変更しない
-- - 更新日時 = 現在日時
-- - 更新利用者ID = JWT認証から取得
-- - 更新利用者名 = JWT認証から取得
-- - 更新端末ID = リクエスト元IP
-- ------------------------------------------------------------

-- ------------------------------------------------------------
-- 11. 削除方式
-- ------------------------------------------------------------
-- このテーブルは物理削除を採用:
-- - DELETE文でデータを完全に削除
-- - 論理削除フラグは使用しない
-- - 削除前に外部キー制約チェックを行う
-- （他のテーブルで使用中の場合は削除不可）
-- ------------------------------------------------------------

-- ------------------------------------------------------------
-- 12. SQLAlchemy ORM定義（参考）
-- ------------------------------------------------------------
-- このテーブルはSQLAlchemyで以下のように定義されます:
--
-- from sqlalchemy import Column, Text
-- from database import Base
--
-- class M商品(Base):
-- __tablename__ = "M商品"
--
-- # 主キー
-- 商品ID = Column(Text, primary_key=True)
--
-- # 業務フィールド
-- 商品名 = Column(Text, nullable=False)
-- 単位 = Column(Text, nullable=False)
-- 商品備考 = Column(Text)
--
-- # 監査フィールド（登録）
-- 登録日時 = Column(Text, nullable=False)
-- 登録利用者ID = Column(Text, nullable=False)
-- 登録利用者名 = Column(Text)
-- 登録端末ID = Column(Text, nullable=False)
--
-- # 監査フィールド（更新）
-- 更新日時 = Column(Text, nullable=False)
-- 更新利用者ID = Column(Text, nullable=False)
-- 更新利用者名 = Column(Text)
-- 更新端末ID = Column(Text, nullable=False)
-- ------------------------------------------------------------

-- ============================================================
-- 変更履歴
-- ============================================================
-- 日付 バージョン 変更者 変更内容
-- ---------- ---------- ------ ------------------------------
-- 2026-02-15 1.0 admin 初版作成
-- ============================================================
