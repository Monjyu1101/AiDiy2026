<!DOCTYPE html>
<html lang="ja">
<head>
 <meta charset="UTF-8" />
 <meta name="viewport" content="width=device-width, initial-scale=1.0" />
 <title>06. フロントエンド開発 | このプロジェクトの歩き方</title>
 <link rel="stylesheet" href="style.css" />
</head>
<body>
 <header>
 <div>
 <h1><a href="_index.html">このプロジェクトの歩き方</a></h1>
 </div>
 </header>

 <div>
 <h1>06. フロントエンド開発</h1>

 <section id="overview">
 <h2>フロントエンドの概要</h2>
 <p>フロントエンドはVue 3 + Vite + TypeScript + Piniaで構成されています。</p>

 <div>
 <strong>この章で学ぶこと</strong>
 <ul>
 <li>ディレクトリ構成の理解</li>
 <li>Vue 3コンポーネントの書き方</li>
 <li>APIとの通信方法</li>
 <li>ルーティングと状態管理</li>
 </ul>
 </div>
 </section>

 <section id="directory-structure">
 <h2>ディレクトリ構成</h2>
 <pre><code>frontend_server/src/

 main.ts # エントリーポイント
 App.vue # ルートコンポーネント

 router/ # ルーティング設定
  index.ts # URLとコンポーネントのマッピング

 api/ # API通信
  client.ts # Axios with JWT interceptor

 components/ # 機能別コンポーネント
  C管理/ # C系 (Core) CRUD画面
  Mマスタ/ # M系 (Master) 画面
  Tトラン/ # T系 (Transaction) 画面
  Vビュー/ # V系 (View) 画面
  Sスケジューラー/ # S系 (Scheduler) 画面
  AIコア/ # AI インターフェース
  Xテスト/ # 実験的機能
  _share/ # 共通部品 (qTubler, dialogs)

 stores/ # Pinia状態管理
  auth.ts # 認証ストア
  ...</code></pre>

 <h3>フォルダの役割</h3>
 <table>
 <thead>
 <tr>
 <th>フォルダ</th>
 <th>役割</th>
 </tr>
 </thead>
 <tbody>
 <tr>
 <td><code>api/</code></td>
 <td>Axiosクライアント (JWT interceptor付き)</td>
 </tr>
 <tr>
 <td><code>components/</code></td>
 <td>機能別の再利用可能なコンポーネント</td>
 </tr>
 <tr>
 <td><code>router/</code></td>
 <td>URLとコンポーネントのマッピング定義</td>
 </tr>
 <tr>
 <td><code>stores/</code></td>
 <td>Piniaによる状態管理ストア</td>
 </tr>
 </tbody>
 </table>
 </section>

 <section id="component-naming">
 <h2>日本語コンポーネント名の制約</h2>
 <p>Vue のファイル名は日本語OK（例: <code>C利用者一覧.vue</code>）ですが、テンプレート内のタグ名には制約があります。</p>

 <div>
 <strong>重要: 日本語タグは無効</strong>
 <p>
 HTMLの仕様上、日本語のタグ名は使用できません。<br>
 <code>&lt;C利用者一覧 /&gt;</code> と書いても<strong>動作しません</strong>。
 </p>
 <pre><code>&lt;!-- NG: 日本語タグは無効 --&gt;
&lt;C利用者一覧 /&gt;

&lt;!-- OK: dynamic component を使う --&gt;
&lt;component :is="C利用者一覧" /&gt;</code></pre>
 </div>
 </section>

 <section id="crud-pattern">
 <h2>CRUD画面の構成パターン</h2>
 <p>各テーブルのCRUD画面は統一されたフォルダ構成に従います。</p>

 <pre><code>components/&lt;カテゴリ&gt;/&lt;テーブル名&gt;/
├── &lt;テーブル名&gt;一覧.vue           # 一覧ページ
├── &lt;テーブル名&gt;編集.vue           # 編集/新規作成ページ
└── components/
    └── &lt;テーブル名&gt;一覧テーブル.vue  # qTublerテーブルラッパー</code></pre>

 <p>例: C利用者の場合</p>
 <pre><code>components/C管理/C利用者/
├── C利用者一覧.vue
├── C利用者編集.vue
└── components/
    └── C利用者一覧テーブル.vue</code></pre>
 </section>

 <section id="qtubler">
 <h2>qTublerシステム（カスタムテーブル）</h2>
 <p>一覧画面のテーブル表示には <code>qTubler</code> というカスタムコンポーネントを使用しています。</p>
 <ul>
 <li>UIフレームワーク（Vuetify等）不使用のカスタム実装</li>
 <li>ソート、ページング、行選択の機能を提供</li>
 <li>統一されたUI/UX</li>
 </ul>
 <p>コンポーネントは <code>components/_share/</code> フォルダに配置されています。</p>

 <h3>共通コンポーネント (_share/)</h3>
 <ul>
 <li><strong>qTubler</strong> — カスタムグリッドテーブル</li>
 <li><strong>qAlert</strong> — 通知ダイアログ</li>
 <li><strong>qConfirm</strong> — 確認ダイアログ</li>
 <li><strong>qColorPicker</strong> — カラーピッカー</li>
 </ul>
 </section>

 <section id="api-communication">
 <h2>API通信 (Vite Proxy)</h2>
 <p>フロントエンドからバックエンドAPIへの通信はVite Proxyを経由します。</p>

 <pre><code> Vite Proxy の仕組み
 ブラウザ → Vite開発サーバー → バックエンドサーバー
/core/C利用者/一覧 →  localhost:8091/core/C利用者/一覧
/apps/M車両/一覧  →  localhost:8092/apps/M車両/一覧
 (CORSの問題を回避)</code></pre>

 <ul>
 <li>フロントエンドでは <code>/core/*</code> や <code>/apps/*</code> のパスでAPIを呼び出します</li>
 <li>Viteの開発サーバーが <code>localhost:8091</code> や <code>localhost:8092</code> にプロキシします</li>
 <li>404エラーが出る場合は<code>vite.config.ts</code>のプロキシ設定を確認してください</li>
 </ul>

 <div>
 <strong>設定ファイル</strong>
 <p><code>frontend_server/vite.config.ts</code> の <code>server.proxy</code> セクションで設定されています。</p>
 <p>
 <code>/core</code> → <code>http://localhost:8091/core</code><br>
 <code>/apps</code> → <code>http://localhost:8092/apps</code>
 </p>
 </div>
 </section>

 <section id="api-client">
 <h2>APIクライアント (apiClient)</h2>
 <p>API呼び出しには <code>src/api/client.ts</code> の Axios インスタンスを使用します。</p>

 <pre><code>import apiClient from '@/api/client'

// 一覧取得
const response = await apiClient.post('/core/C利用者/一覧')
if (response.data.status === 'OK') {
  items.value = response.data.data.items
}</code></pre>

 <ul>
 <li>JWTトークンは自動的に <code>Authorization</code> ヘッダーに付与されます（interceptor設定済み）</li>
 <li>トークン期限切れ時は自動的にログイン画面にリダイレクトされます</li>
 <li>全てのCRUD操作は<strong>POST</strong>メソッドで送信します</li>
 </ul>
 </section>

 <section id="component-structure">
 <h2>Vue 3コンポーネント構造</h2>
 <p>Vue 3では <code>&lt;script setup&gt;</code> 構文を使用しています。</p>

 <pre><code>&lt;script setup&gt;
// コンポーネントのロジック
import { ref, onMounted } from 'vue'

const count = ref(0) // リアクティブな変数
const increment = () => count.value++ // メソッド

onMounted(() => {
 // コンポーネント読み込み時の処理
})
&lt;/script&gt;

&lt;template&gt;
 &lt;!-- HTMLテンプレート --&gt;
 &lt;button @click="increment"&gt;{{ count }}&lt;/button&gt;
&lt;/template&gt;

&lt;style scoped&gt;
/* CSSはscopedで他のコンポーネントに影響しない */
&lt;/style&gt;</code></pre>

 <h3>ポイント</h3>
 <ul>
 <li><code>ref()</code> でリアクティブな変数を定義</li>
 <li><code>onMounted()</code> でコンポーネント読み込み時の処理を記述</li>
 <li><code>scoped</code> でスタイルをコンポーネント内に限定</li>
 </ul>
 </section>

 <section id="routing">
 <h2>ルーティング</h2>
 <p>Vue Routerを使ってURLとコンポーネントを対応付けています。</p>

 <h3>1. ページコンポーネント作成</h3>
 <p><code>src/views/MyNewView.vue</code> にページコンポーネントを作成します。</p>

 <h3>2. ルート登録</h3>
 <p><code>src/router/index.js</code> にルートを追加します。</p>
 <pre><code>{
 path: '/mynew',
 name: 'MyNew',
 component: () => import('../views/MyNewView.vue')
}</code></pre>

 <h3>3. ナビゲーションリンク</h3>
 <p>テンプレートにリンクを追加します。</p>
 <pre><code>&lt;router-link to="/mynew"&gt;新しいページ&lt;/router-link&gt;</code></pre>
 </section>

 <section id="state-management">
 <h2>Pinia (状態管理)</h2>
 <p>Piniaを使ってコンポーネント間で状態を共有します。</p>

 <h3>Storeの定義</h3>
 <pre><code>// stores/auth.js
import { defineStore } from 'pinia'

export const useAuthStore = defineStore('auth', {
 state: () => ({
 user: null,
 token: null
 }),
 actions: {
 setUser(user) {
 this.user = user
 }
 }
})</code></pre>

 <h3>コンポーネントで使用</h3>
 <pre><code>&lt;script setup&gt;
import { useAuthStore } from '@/stores/auth'

const authStore = useAuthStore()
console.log(authStore.user)
&lt;/script&gt;</code></pre>
 </section>

 <section id="layout">
 <h2>レイアウトシステム</h2>
 <p>画面のレイアウトは共有コンポーネントで統一されています。</p>
 <ul>
 <li><strong>_Layout</strong> — 全体のレイアウト枠（サイドバー + メインエリア）</li>
 <li><strong>_TopBar</strong> — 画面上部のバー（ユーザー名、ログアウト等）</li>
 <li><strong>_TopMenu</strong> — トップメニュー（カテゴリ別ナビゲーション）</li>
 </ul>
 </section>

 <section id="next">
 <h2>次のステップ</h2>
 <p>フロントエンドの基本を理解したら、次はテストの書き方を学びましょう。</p>

 <div>
 <a href="07_テストの書き方.html">
 <span>次の章へ</span>
 <strong>07. テストの書き方 →</strong>
 <span>手動テストとデバッグの方法を学びます</span>
 </a>
 </div>
 </section>
 </div>

 <footer>
 <p>
 <a href="05_データベース管理.html">← 前: 05. データベース管理</a> |
 <a href="_index.html">トップページ</a> |
 <a href="07_テストの書き方.html">次: 07. テストの書き方 →</a>
 </p>
 </footer>
</body>
</html>
